<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- SEC-006 FIX: Content Security Policy to prevent XSS and inline script injection -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://www.googleapis.com https://classroom.googleapis.com https://accounts.google.com;">
  <title>ClassMate - Classroom Downloader</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- SEC-007 FIX: Added crossorigin attribute for CORS font loading -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" crossorigin="anonymous">
</head>

<body>
  <div class="gcr-popup-container" id="popup-container">

    <!-- Header -->
    <header class="gcr-header" id="header">
      <div class="gcr-header-left">
        <div class="gcr-header-logo">ğŸ“š</div>
        <div class="gcr-header-info">
          <h1 class="gcr-header-title">ClassMate</h1>
          <span class="gcr-header-subtitle">Classroom Downloader</span>
        </div>
      </div>
      <div class="gcr-header-right">
        <div class="gcr-course-badge" id="course-badge" title="Current course">
          <span id="course-name">Loading...</span>
        </div>
        <button class="gcr-header-btn" id="settings-btn" title="Settings" aria-label="Open settings">âš™ï¸</button>
        <button class="gcr-header-btn" id="close-btn" title="Close" aria-label="Close popup">âœ•</button>
      </div>
    </header>

    <!-- Settings Panel -->
    <div class="gcr-settings" id="settings-panel" role="dialog" aria-label="Settings">
      <div class="gcr-settings-title">ğŸ¨ Theme</div>
      <div class="gcr-theme-options">
        <label class="gcr-theme-option" data-theme="light">
          <input type="radio" name="theme" value="light">
          <span>â˜€ï¸ Light</span>
        </label>
        <label class="gcr-theme-option" data-theme="dark">
          <input type="radio" name="theme" value="dark">
          <span>ğŸŒ™ Dark</span>
        </label>
        <label class="gcr-theme-option active" data-theme="system">
          <input type="radio" name="theme" value="system" checked>
          <span>ğŸ’» System</span>
        </label>
      </div>
    </div>

    <!-- Toolbar -->
    <div class="gcr-toolbar">
      <!-- Search Row -->
      <div class="gcr-toolbar-row">
        <div class="gcr-search">
          <span class="gcr-search-icon">ğŸ”</span>
          <input type="text" class="gcr-search-input" id="search-input" placeholder="Search files..."
            aria-label="Search files">
          <button class="gcr-search-clear" id="search-clear" aria-label="Clear search">âœ•</button>
          <div class="gcr-search-scope">
            <button class="gcr-search-scope-btn" id="scope-btn">
              <span id="scope-label">Name</span>
              <span class="arrow">â–¾</span>
            </button>
            <div class="gcr-search-scope-menu" id="scope-menu">
              <div class="gcr-search-scope-option active" data-scope="name">ğŸ“ Name</div>
              <div class="gcr-search-scope-option" data-scope="type">ğŸ“ Type</div>
              <div class="gcr-search-scope-option" data-scope="uploader">ğŸ‘¤ Uploader</div>
            </div>
          </div>
        </div>
        <div class="gcr-sort">
          <button class="gcr-sort-btn" id="sort-btn">
            <span>â†•ï¸</span>
            <span id="sort-label">Name</span>
            <span class="arrow">â–¾</span>
          </button>
          <div class="gcr-sort-menu" id="sort-menu">
            <div class="gcr-sort-option active" data-sort="name-asc">ğŸ“ Name (A-Z)</div>
            <div class="gcr-sort-option" data-sort="name-desc">ğŸ“ Name (Z-A)</div>
            <div class="gcr-sort-option" data-sort="date-desc">ğŸ“… Newest First</div>
            <div class="gcr-sort-option" data-sort="date-asc">ğŸ“… Oldest First</div>
            <div class="gcr-sort-option" data-sort="size-desc">ğŸ“¦ Largest First</div>
            <div class="gcr-sort-option" data-sort="size-asc">ğŸ“¦ Smallest First</div>
            <div class="gcr-sort-option" data-sort="type">ğŸ“ By Type</div>
            <div class="gcr-sort-option" data-sort="category">ğŸ—‚ï¸ By Category</div>
          </div>
        </div>
      </div>

      <!-- Tab Navigation -->
      <div class="gcr-toolbar-row">
        <div class="gcr-tabs" id="uploader-tabs">
          <button class="gcr-tab active" data-tab="all">
            All <span class="count" id="count-all">0</span>
          </button>
          <button class="gcr-tab" data-tab="teacher">
            ğŸ‘¨â€ğŸ« Teacher <span class="count" id="count-teacher">0</span>
          </button>
          <button class="gcr-tab" data-tab="student">
            ğŸ‘¨â€ğŸ“ Student <span class="count" id="count-student">0</span>
          </button>
          <div class="gcr-tab-indicator" id="tab-indicator"></div>
        </div>
      </div>

      <!-- Smart Filters -->
      <div class="gcr-filters-panel" id="filters-panel">
        <div class="gcr-filters-header" id="filters-header">
          <span class="gcr-filters-title">ğŸ¯ Smart Filters</span>
          <span class="gcr-filters-toggle">â–¾</span>
        </div>
        <div class="gcr-filters-content">
          <div class="gcr-filter-group">
            <span class="gcr-filter-label">Content Type</span>
            <div class="gcr-filters" id="type-filters">
              <button class="gcr-filter-pill active" data-filter="all">
                ğŸ“ All <span class="count" id="filter-count-all">0</span>
              </button>
              <button class="gcr-filter-pill" data-filter="materials">
                ğŸ“– Materials <span class="count" id="filter-count-materials">0</span>
              </button>
              <button class="gcr-filter-pill" data-filter="announcements">
                ğŸ“¢ Announcements <span class="count" id="filter-count-announcements">0</span>
              </button>
              <button class="gcr-filter-pill" data-filter="links">
                ğŸ”— Links <span class="count" id="filter-count-links">0</span>
              </button>
            </div>
          </div>
          <div class="gcr-filter-group">
            <span class="gcr-filter-label">File Format</span>
            <div class="gcr-filters" id="format-filters">
              <button class="gcr-filter-pill" data-format="pdf">
                ğŸ“„ PDFs <span class="count" id="filter-count-pdf">0</span>
              </button>
              <button class="gcr-filter-pill" data-format="slides">
                ğŸ“Š Slides <span class="count" id="filter-count-slides">0</span>
              </button>
              <button class="gcr-filter-pill" data-format="docs">
                ğŸ“ Docs <span class="count" id="filter-count-docs">0</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Bulk Actions -->
      <div class="gcr-toolbar-row">
        <button class="gcr-filter-pill" id="select-all-btn" aria-label="Select all files">â˜‘ï¸ Select All</button>
        <button class="gcr-filter-pill" id="deselect-all-btn" aria-label="Deselect all files">â˜ Deselect</button>
        <div style="flex:1"></div>
        <span class="gcr-footer-size" id="selected-info">0 files selected</span>
      </div>
    </div>

    <!-- Content Area -->
    <main class="gcr-content" id="content-area">

      <!-- Loading State -->
      <div class="gcr-loading" id="state-loading">
        <div class="gcr-spinner"></div>
        <div class="gcr-loading-text">Fetching your course materials...</div>
      </div>

      <!-- Empty State -->
      <div class="gcr-empty hidden" id="state-empty">
        <div class="gcr-empty-icon">ğŸ“­</div>
        <div class="gcr-empty-title">No Course Data</div>
        <div class="gcr-empty-text">Visit a Google Classroom course to start downloading materials.</div>
      </div>

      <!-- Error State -->
      <div class="gcr-error hidden" id="state-error">
        <div class="gcr-error-icon">âš ï¸</div>
        <div class="gcr-error-title">Something Went Wrong</div>
        <div class="gcr-error-text" id="error-message">Unable to load course data.</div>
        <button class="gcr-btn gcr-btn-secondary" id="retry-btn">ğŸ”„ Retry</button>
      </div>

      <!-- Auth State -->
      <div class="gcr-empty hidden" id="state-auth">
        <div class="gcr-empty-icon">ğŸ”</div>
        <div class="gcr-empty-title">Sign In Required</div>
        <div class="gcr-empty-text">Sign in with Google to access your classroom materials.</div>
        <button class="gcr-btn gcr-btn-primary" id="sign-in-btn" style="margin-top:16px;">Sign In with Google</button>
      </div>

      <!-- Search Empty State -->
      <div class="gcr-empty hidden" id="search-empty">
        <div class="gcr-empty-icon">ğŸ”</div>
        <div class="gcr-empty-title">No Results Found</div>
        <div class="gcr-empty-text" id="search-empty-text">No files match your search.</div>
      </div>

      <!-- File List -->
      <div class="gcr-files-container hidden" id="state-data">

        <!-- Materials Category -->
        <div class="gcr-category" id="category-materials" data-category="materials">
          <div class="gcr-category-header">
            <div class="gcr-category-left">
              <span class="gcr-category-icon">ğŸ“–</span>
              <span class="gcr-category-title">Materials & Slides</span>
            </div>
            <div class="gcr-category-right">
              <span class="gcr-category-count" id="materials-count">0 files</span>
              <span class="gcr-category-toggle">â–¼</span>
            </div>
          </div>
          <div class="gcr-category-items" id="materials-list"></div>
        </div>

        <!-- Announcements Category -->
        <div class="gcr-category" id="category-announcements" data-category="announcements">
          <div class="gcr-category-header">
            <div class="gcr-category-left">
              <span class="gcr-category-icon">ğŸ“¢</span>
              <span class="gcr-category-title">Announcements</span>
            </div>
            <div class="gcr-category-right">
              <span class="gcr-category-count" id="announcements-count">0 files</span>
              <span class="gcr-category-toggle">â–¼</span>
            </div>
          </div>
          <div class="gcr-category-items" id="announcements-list"></div>
        </div>

        <!-- Assignments Category -->
        <div class="gcr-category" id="category-assignments" data-category="assignments">
          <div class="gcr-category-header">
            <div class="gcr-category-left">
              <span class="gcr-category-icon">ğŸ“</span>
              <span class="gcr-category-title">Assignments</span>
            </div>
            <div class="gcr-category-right">
              <span class="gcr-category-count" id="assignments-count">0 files</span>
              <span class="gcr-category-toggle">â–¼</span>
            </div>
          </div>
          <div class="gcr-category-items" id="assignments-list"></div>
        </div>

        <!-- Links Category -->
        <div class="gcr-category" id="category-links" data-category="links">
          <div class="gcr-category-header">
            <div class="gcr-category-left">
              <span class="gcr-category-icon">ğŸ”—</span>
              <span class="gcr-category-title">Links & Videos</span>
            </div>
            <div class="gcr-category-right">
              <span class="gcr-category-count" id="links-count">0 links</span>
              <span class="gcr-category-toggle">â–¼</span>
            </div>
          </div>
          <div class="gcr-category-items" id="links-list"></div>
        </div>

      </div>
    </main>

    <!-- Footer -->
    <footer class="gcr-footer" id="footer">
      <div class="gcr-footer-info">
        <div class="gcr-footer-selected">
          <strong id="selected-count">0</strong> files selected
        </div>
        <div class="gcr-footer-size" id="selected-size">Select files to download</div>
      </div>
      <div class="gcr-footer-actions">
        <button class="gcr-btn gcr-btn-secondary gcr-btn-icon" id="refresh-btn" title="Refresh data"
          aria-label="Refresh course data">
          <span id="refresh-icon">ğŸ”„</span>
        </button>
        <button class="gcr-btn gcr-btn-primary" id="download-btn" disabled aria-label="Download selected files">
          <span>ğŸ“¥</span>
          <span>Download</span>
          <span class="gcr-btn-badge hidden" id="download-badge">0</span>
        </button>
      </div>
    </footer>

    <!-- Progress Overlay -->
    <div class="gcr-progress-overlay" id="progress-overlay" role="alertdialog" aria-labelledby="progress-title" aria-describedby="progress-file">
      <div class="gcr-progress-title" id="progress-title">ğŸ“¥ Downloading...</div>
      <div class="gcr-progress-subtitle" id="progress-file" aria-live="polite">Preparing your files...</div>
      <div class="gcr-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
        <div class="gcr-progress-fill" id="progress-fill" style="width: 0%"></div>
      </div>
      <div class="gcr-progress-stats" id="progress-stats" aria-live="polite">0 / 0 files</div>
      <div class="gcr-progress-actions">
        <button class="gcr-btn gcr-btn-secondary" id="cancel-download-btn">âŒ Cancel</button>
      </div>
    </div>

    <!-- HIGH-007 FIX: Privacy Policy and Version Info -->
    <div class="gcr-footer-meta" style="display:flex;justify-content:center;gap:16px;padding:8px 12px;font-size:11px;color:#94a3b8;border-top:1px solid rgba(148,163,184,0.2);background:rgba(0,0,0,0.02);">
      <span id="version-badge" title="ClassMate version">v1.0.5</span>
      <span style="color:#cbd5e1;">â€¢</span>
      <a href="docs/privacy.html" target="_blank" rel="noopener noreferrer" style="color:#8b5cf6;text-decoration:none;" aria-label="View Privacy Policy">ğŸ”’ Privacy Policy</a>
      <span style="color:#cbd5e1;">â€¢</span>
      <a href="https://classmateextension.dev" target="_blank" rel="noopener noreferrer" style="color:#8b5cf6;text-decoration:none;" aria-label="Get help">â“ Help</a>
    </div>

  </div>

  <script src="popup.js"></script>
</body>

</html>